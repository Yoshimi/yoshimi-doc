%-------------------------------------------------------------------------------
% yum_command_line
%-------------------------------------------------------------------------------
%
% \file        yum_command_line.tex
% \library     Documents
% \author      Chris Ahlstrom
% \date        2015-09-06
% \update      2016-02-28
% \version     $Revision$
% \license     $XPC_GPL_LICENSE$
%
%     Provides the description of the no-gui mode of Yoshimi.
%
%-------------------------------------------------------------------------------

\section{The Yoshimi Command Line Interface}
\label{sec:command_line}

   Applies through version:  1.3.9

   \textsl{Yoshimi} provides a "no GUI" or "command-line" mode of operation
   where some aspects of the application can be controlled via textual commands.
   This mode is useful for blind people, for example.  To access this mode, add
   the \texttt{-i} or \texttt{--no-gui} command-line option when starting
   \textsl{Yoshimi} on the command-line.  But note that, when starting
   \textsl{Yoshimi} on the command-line, the "command-line" mode of operation is
   available at the same time as the GUI.

   One of the main features of recent \textsl{Yoshimi} releases
   is improved non-GUI
   accessibility.  In a command line environment, almost all the 'running'
   commands are available, but none of the instrument editing ones are... yet!
   One can decide what MIDI/audio setup is wanted, list and set roots and banks,
   load instruments into any part, change a part's channel, set main volume and
   key shift, and set up vector control.  A number of first-time defaults have
   been changed to make this feataure easier.

   When starting from the command line, an argument can be included for a new
   root path to be defined to point to a set of banks fetched from elsewhere.
   This will be given the next free ID. A future upgrade will allow the ID to
   be set to any valid one when it is created, mirroring the GUI behaviour.

   Once running, almost all dynamic setup (i.e. doesn't require a restart) can now
   be done within the terminal window. There is also extensive control of roots,
   banks, parts and instruments including the ability to list and set all of
   these.

   Additional controls that are frequently taken for granted in the GUI, but
   otherwise get forgotten, are \textsl{master key shift} and \textsl{master
   volume}.  The most important parts of vector control are exposed to the
   command line.

   The command-line mode provides extensive error checking and feedback.
   Note the change in nomenclature from "Parameters" to "Patch Set", which is
   visible in the main screen, and also reflected in the command line.
   The prompt will always show what level
   one is on, along with relevant information.
   At the CLI prompt, when effects are being managed, the preset number is also
   shown on the prompt so you'll typically see something like:

   \begin{verbatim}
      yoshimi part 2 FX 1 Rever-7 >
   \end{verbatim}

   One will also get a confirmation message, but, for clarity,
   those are not included in the examples below.
   Here is an example session:

   Starting from the \texttt{yoshimi} prompt:

   \begin{verbatim}
      yoshimi> s p 2 pr 107
      yoshimi part 2 >
   \end{verbatim}

   This command \textbf{s}ets \textbf{p}art number 2 to \textbf{pr}ogram
   number 107 from the \textsl{current} instrument bank.
   \textsl{Yoshimi} is now on part 2 as the current part (indicated by the
   prompt), and all subsequent commands will relate to this "level".
   At this level, one can change the current part simply with:

   \begin{verbatim}
      yoshimi part 2 > s 4
      yoshimi part 4 >
   \end{verbatim}

   \textsl{Yoshimi} is now on part number 4. Now set an effect:

   \begin{verbatim}
      yoshimi part 4 > s ef ty re
      yoshimi part 4 FX 0 rever-0 >
   \end{verbatim}

   This command \textbf{s}ets the part's \textbf{ef}fect 0 (implicit) to
   \textbf{ty}pe \textbf{re}verb.

   Note that many settings parameters are optional, and if you omit them,
   either a default or last-used value will be assumed. Also, names are
   truncated to 5 characters so the prompt line doesn't get unmanageably long.

   From here you can set a preset for this effect:

   \begin{verbatim}
      yoshimi part 4 FX 0 rever > s pre 3
   \end{verbatim}

   Currently, the \textbf{pre}sets are not shown in the prompt, but one
   will get a confirmation message.

   Settings that follow in a direct command "path" through several levels
   can be made all at once, and one will be left at the appropriate level.
   Thus, summarizing some of the above commands:

   \begin{verbatim}
      s p 4 ef 2 ty re
      yoshimi part 4 FX 2 rever >
   \end{verbatim}

   One cannot combine \texttt{type} and \texttt{preset} as they
   are both at the same level.  To go back one level, use the
   ".." command:

   \begin{verbatim}
      yoshimi part 4 FX 2 rever > ..
      yoshimi part 4 >
   \end{verbatim}

   To go back to the top command level, use the "/" command:

   \begin{verbatim}
      yoshimi part 4 > /
      yoshimi >
   \end{verbatim}

   These two special level-movement commands can also be put on the front of
   any other command.  Starting where we were before:

   \begin{verbatim}
      yoshimi part 4 FX 2 rever > .. s vol 70
      yoshimi part 4 >
   \end{verbatim}

   Part 4 volume is now at 70, and \textsl{Yoshimi} is once again at the
   "part level", not the "part FX level".  Also note that the space after
   the ".." is optional.

   The help menus and lists are also partially context sensitive. This
   feature should help avoid clutter and confusion.

   As well as an immediate history, \textsl{Yoshimi} maintains a command
   history file, so provided one makes a normal command-line exit, the last
   commands will be available on the next run of \textsl{Yoshimi}..

   Originally this section described the currently implemented commands,
   but as the command set is very much a moving target, it is simpler to just
   ask one to run Yoshimi and type the "?" command.

   Commands with "*" in the description need the setup to be saved,
   and \textsl{Yoshimi} restarted to be activated. 

   More will be added, and the organisation of them may be changed slightly.
   If any configuratiion settings are changed, either at the command-line
   or in the graphical user-interface, one will be given a warning when
   exiting, with the option to continue running so one can save the changes.

\subsection{Command Level}
\label{subsec:command_line_command_level}

   A command level is simply a position in the hierarchy of commands that cover
   some aspect of \textsl{Yoshimi} functionality.

   The levels that currently exist are:

   \begin{itemize}
      \item \textbf{Top Level}
      \item \textbf{System Effects}
      \item \textbf{Insertion Effects}
      \item \textbf{Part}
      \item \textbf{Part Effects}
      \item \textbf{Vector}
   \end{itemize}

Ones that we're pretty sure will be added are:

   \begin{itemize}
      \item \textbf{Scales (microtonal)}
      \item \textbf{Controllers}
      \item \textbf{Addsynth}
      \item \textbf{Addsynth Voice}
      \item \textbf{Subsynth}
      \item \textbf{Padsynth Harmonics}
      \item \textbf{Padsynth Envelopes}
   \end{itemize}

   Any level that has a direct numerical content will be changeable simply with
   "set (n)" once you are at that level.  The level will, of course, be
   indicated by the text in the \textsl{Yoshimi} prompt.

   For example, one can have 0 to 15 vector channels, so from the
   \textsl{Top} level, the following command
   will return the default  (0 or the last-used number):

   \begin{verbatim}
      set vector
      s ve
   \end{verbatim}

   Given this level (the \textsl{Vector} level), the following commands...

   \begin{verbatim}
      set 5 
      s 5
   \end{verbatim}

   ...will then switch to vector channel 5.
   However, at the start, one could have gone straight there with:

   \begin{verbatim}
      set vector 5
      s ve 5
   \end{verbatim}

\subsection{Command Table}
\label{subsec:command_line_command_table}

   When running from the command line, these commands
   (see \tableref{table:yoshimi_text_commands})
   can be entered after the 'up and running' message.
   The commands are not case-sensitive.
   The commands can be abbreviated to the first three letters of each command.
   There are a group of commands that are always available. These are

   \begin{itemize}
      \item \texttt{?} (Help)
      \item \texttt{List}
      \item \texttt{RESet}
      \item \texttt{EXit}
   \end{itemize}

   Apart from these basic commands, the command line works on a system of
   context levels, and normally only the commands relevant to that "level" will
   be available.

   The brief descriptions in the following table can be obtained
   using the "help" command in the \textsl{Yoshimi} command-line mode.
   More detailed descriptions are given in the section following the table.

   The \texttt{paths} command no longer exists. Instead we have \texttt{add} \&
   \texttt{remove}, so instead of \texttt{path add} it's \texttt{add root}. Also
   you can now add and remove banks using the same structure. \texttt{paths
   show} has now been moved into lists as \texttt{list roots}.  These changes
   make roots/banks/instruments more consistent.

   \begin{table}[H]
      \centering
      \caption{Yoshimi Text Commands, Part 1}
      \label{table:yoshimi_text_commands_part_1}
      \begin{tabular}{l l}

         \texttt{..} &
            Step back up one command level. \\

         \texttt{/} &
            Step back up to the top command level. \\

         \texttt{add bank [s]} &
            Define a new bank and add it to the current root. \\

         \texttt{add root [s]} &
            Define a new root path and add it to the list. \\

         \texttt{remove bank [s]} &
            Delete the bank and all its contents from the current root. \\

         \texttt{remove root [s]} &
            De-list the root path ID. \\

         \texttt{list banks [n]} &
            List instruments and IDs in bank \textsl{n} or the
            current bank/root. \\

         \texttt{list effects [n]} &
            List effect types for \textsl[n].  \\

         \texttt{list effects all} &
            List every effect and all its presets along with the
            preset number. \\

         \texttt{list instruments [n]} &
            List all instruments and IDs in bank \textsl{n}
            or current bank/root. \\

         \texttt{list parts} &
            List number of parts available, and more. \\

         \texttt{list roots} &
            List all available root paths. \\

         \texttt{list setup} &
            Displays the current dynamic system settings. \\

         \texttt{list vectors [n]} &
            Lists the settings for all enabled vectors. \\

         \texttt{load instrument [n]} &
            Loads an instrument. \\

         \texttt{load patchset [s]} &
            Load a complete patch set from a named file. \\

         \texttt{save patchset [s]} &
            Save the patch set to a named file. \\

         \texttt{save instrument [n]} &
            Saves an instrument. \\

         \texttt{save setup} &
            Save the current dynamic system settings. \\

         \texttt{set activate [n]} &
            Set part-activate on MIDI program change (\textsl{n}=0 disables
            1 enables). \\

         \texttt{set alsa audio [s]} * &
            Sets the name of the audio hardware device ALSA looks for. \\

         \texttt{set alsa midi [s]} * &
            Sets the name of the MIDI source ALSA looks for. \\

         \texttt{set available [n]} &
            Set the number of available parts (16, 32, 64). \\

         \texttt{set bank [n]} &
            Set current bank to ID \textsl{n}. \\

         \texttt{set ccbank [n]} &
            Set the MIDI CC for bank changes (non-0 or non-32 disables). \\

         \texttt{set ccroot [n]} &
            Set the MIDI CC for root path changes (above 119 disables). \\

         \texttt{set extend [n]} &
            Set CC value for extended program change (above 119 disables). \\

         \texttt{set insert effects [n]} &
            Set insertion effects for editing. \\

         \texttt{set jack midi [s]} * &
            Sets the name of the JACK MIDI source for Yoshimi. \\

         \texttt{set jack server [s]} * &
            Sets the name of the JACK server for Yoshimi. \\

         \texttt{set part [n1] program [n2]} &
            Load instrument \textsl{n2} into part \textsl{n1}. \\

         \texttt{set part [n1] channel [n2]} &
            Set the MIDI channel \textsl{n2} for part \textsl{n1}. \\

         \texttt{set part [n1] destination [n2]} &
            Set audio destination of part \textsl{n1}
            to main (\textsl{1}), part (\textsl{2}), both (\textsl{3}). \\

         \texttt{set preferred audio [s]} * &
            Set audio connection type (jack/alsa). \\

         \texttt{set preferred midi [s]} * &
            Set MIDI connection type (jack/alsa). \\

      \end{tabular}
   \end{table}

   \begin{table}[H]
      \centering
      \caption{Yoshimi Text Commands, Part 2}
      \label{table:yoshimi_text_commands_part_2}
      \begin{tabular}{l l}

         \texttt{set - preset [n]} &
            Set effect preset. \\

         \texttt{set - preset [n]} &
            Set numbered effect preset. \\

         \texttt{set program [n]} &
            Set MIDI program change (0 disables, anything else enables). \\

         \texttt{set reports [n]} &
            Set report destination (gui, stderr, show, and hide). \\

         \texttt{set root [n]} &
            Set current root path to ID \textsl{n}. \\

         \texttt{set shift [n]} &
            Set master key shift for notes, semitones (+- octave,
            64=no shift). \\

         \texttt{set system effects [n]} &
            Set System Effects for editing. \\

         \texttt{set vector [n1] x/y cc [n2]} &
            CC \textsl{n2} is for ch. \textsl{n1} X/Y axis sweep.
            For X, enables vector. \\

         \texttt{set vector [n1] x/y features [n2]} &
            Sets channel \textsl{n1} X or Y features to \textsl{n2}. \\

         \texttt{set vector [n1] x/y program [l/r] [n2]} &
            Loads program \textsl{n2} to ch. \textsl{n1} X or Y
            \textsl{left} or \textsl{right} part. \\

         \texttt{set vector [n1] x/y control [n2] [n3]} &
            Sets \texttt{n3} CC to use for X or Y feature \texttt{n2}
            (2, 4, 8). \\

         \texttt{set vector [n] [off]} &
            Disables vector control for channel \textsl{n}. \\

         \texttt{set volume [n]} &
            Set the master volume. \\

         \texttt{reset} &
            Return to the start-up conditions, if 'y' selected. \\

         \texttt{stop} &
            Cease all sound immediately! \\

         \texttt{mode [s]} &
            Change to different menus: addsynth, subsynth, or padsynth. \\

         \texttt{?} or \texttt{help} &
            List all commands. \\

         \texttt{exit} &
            Tidy up and close Yoshimi down, if 'y' selected. \\

      \end{tabular}
   \end{table}

   Entries marked with an asterisk need to be saved, and \textsl{Yoshimi}
   restarted, to activatate.

   Commands are not case sensitive, and an invalid one will print a reminder.
   Often one needs only the first letter of a command, as long as it is
   unambiguous. The examples above show their minimum abbreviations in capitals.
   However, Yoshimi is quite pedantic, and if you type the command in full it
   must be exactly correct!

   All number ranges start from zero. This is different from the GUI where most
   (but not all) start from one. So CL part 0 is GUI part 1, but CL bank 0 is
   GUI bank 0.

   More commands will be added, and the organisation of the commands
   may change slightly.

\subsection{Command Descriptions}
\label{subsec:command_line_command_descriptions}

   This section describes the command-line commands in more detail.

   \setcounter{ItemCounter}{0}      % Reset the ItemCounter for this list.

%  \itempar{load patchset [s]}{cmd!load patchset}
%     Loads a complete patch set from the named file.

   \itempar{..}{cmd!up one level}
      Step back up one command level.

   \itempar{/}{cmd!to top level}
      Step back up to the top command level.

   \itempar{add bank [s]}{cmd!add bank}
      Define a new bank and add it to the current root.

   \itempar{add root [s]}{cmd!add root}
      Define a new root path and add it to the list.

   \itempar{remove bank [s]}{cmd!remove bank}
      Delete the bank and all its contents from the current root.

   \itempar{remove root [s]}{cmd!remove root}
      De-list the root path ID.

   \itempar{list banks [n]}{cmd!list banks}
      List instruments and IDs in bank \textsl{n} or the
      current bank/root.

   \itempar{list effects [n]}{cmd!list effects}
      List effect types for \textsl[n].
      If the parameter is 'all', then list every effect and all its presets
      along with the preset number.

   \itempar{list instruments [n]}{cmd!list instruents}
      List all instruments and IDs in bank \textsl{n}
      or the current bank/root.

   \itempar{list parts}{cmd!list parts}
      Lists the number of parts available and parts with instruments
      currently installed along with any enabled with the default sound.
      Also shows their audio destination:
      \textsl{M} = main L/R, \textsl{P} = part L/R, \textsl{B} = both, and
      \textsl{-} = disabled or unavailable.
      This way one can tell if an instrument patch is installed even if it is
      not currently usable.
      To avoid unnecessary list length, the default "Simple Sound" is not shown
      unless it is enabled.

   \itempar{list roots}{cmd!list roots}
      Displays all available root paths.

   \itempar{list setup}{cmd!list setup}
      Displays the current dynamic system settings.

   \itempar{list vector [n]}{cmd!list vector}
      Lists the settings for vector on channel \textsl{n}.

   \itempar{load instrument [n]}{cmd!load instrument}
      Loads an instrument.

   \itempar{load patchset [s]}{cmd!load instrument}
      Load a complete patch set from a named file.

   \itempar{save instrument [n]}{cmd!save instrument}
      Saves an instrument. \\

   \itempar{save setup}{cmd!save setup}
      Save the current dynamic system settings.

   \itempar{save patchset [s]}{cmd!save patchset}
      Save the patch set to a named file.

   \itempar{set activate [n]}{cmd!set activate}
      Set part-activate on MIDI program change (\textsl{n}=0 disables
      1 enables).
      This feature applies to command line program change as well.

   \itempar{set alsa audio [s]}{cmd!set alsa audio}
      Sets the name of the audio hardware device ALSA looks for.
      Requires a restart.

   \itempar{set alsa midi [s]}{cmd!set alsa midi}
      Sets the name of the MIDI source ALSA looks for.

   \itempar{set available [n]}{cmd!set available}
      Set the number of available parts (16, 32, 64).

   \itempar{set bank [n]}{cmd!set bank}
      Set current bank to ID \textsl{n}.

   \itempar{set ccbank [n]}{cmd!set ccbank}
      Set the MIDI CC for bank changes (anything other than 0 or 32
      disables it).

   \itempar{set ccroot [n]}{cmd!set ccroot}
      Set the MIDI CC for root path changes (above 119 disables).

   \itempar{set extend [n]}{cmd!set extend}
      Set CC value for extended program change (above 119 disables).

   \itempar{set insert effects [n]}{cmd!set insert effects}
      Set insertion effects for editing.

   \itempar{set jack midi [s]}{cmd!set jack midi}
      Sets the name of the JACK MIDI source for Yoshimi.
      Requires a restart.

   \itempar{set jack server [s]}{cmd!set jack server}
      Sets the name of the JACK server Yoshimi tries to connect to.
      Requires a restart.

   \itempar{set part [n1] program [n2]}{cmd!set part program}
      Load instrument \textsl{n2} into part \textsl{n1}.
      Example: \texttt{set part 4 program 130}

   \itempar{set part [n1] channel [n2]}{cmd!set part channel}
      Set the MIDI channel \textsl{n2} for part \textsl{n1}.
      If the channel number is greater than 15, no further MIDI
      messages will be accepted by that part.

   \itempar{set part [n1] destination [n2]}{cmd!set part destination}
      Set the audio destination of part \textsl{n1}
      to main (\textsl{1}), part (\textsl{2}), both (\textsl{3}).
      Also enables the part if not already enabled.

   \itempar{set preferred audio [s]}{cmd!set preferred audio}
      Set audio connection type (jack/alsa).

   \itempar{set preferred midi [s]}{cmd!set preferred midi}
      Set MIDI connection type (jack/alsa).

   \itempar{set - preset [n]}
      Set effect preset.
      Set numbered effect preset.

   \itempar{set program [n]}{cmd!set program}
      Set MIDI program change (0 disables, anything else enables).

   \itempar{set reports [n]}{cmd!set reports}
      Set report destination (1 = GUI, anything else sets stderr).

   \itempar{set root [n]}{cmd!set root}
      Set current root path to ID \textsl{n}.

   \itempar{set shift [n]}{cmd!set shift}
      Set the master key shift for following notes in semitones (+-
      octave, 64 for no shift).


   \itempar{set system effects [n]}{cmd!set system effects}
      Set System Effects for editing.

   \itempar{set vector [n1] x/y cc [n2]}{cmd!set vector cc}
      CC \textsl{n2} is used for channel \textsl{n1} X or Y axis sweep.
      For X, this also enables vector control for the channel.

   \itempar{set vector [n1] x/y features [n2]}{cmd!set vector features}
      Sets channel \textsl{n1} X or Y features to \textsl{n2}.

   \itempar{set vector [n1] x/y program [l/r] [n2]}{cmd!set vector program}
      Loads program \textsl{n2} to channel \textsl{n1} X or Y
      \textsl{left} or \textsl{right} part.

   \itempar{set vector [n1] x/y control [n2] [n3]}{cmd!set vector control}
      Sets \texttt{n3} CC to use for X or Y feature \texttt{n2} (2, 4, 8).
      \textsl{n3} is the CC to be used for feature number \textsl{n2} on X
      vector channel \textsl{n1}. The \textsl{x} is a sort of hidden parameter
      as the code uses an offset dependent on whether it is \textsl{x} or
      \textsl{y}. Also \textsl{n1} can be omitted in which case it will use the
      last defined channel number. Using alternate words and numbers gives a
      great deal of flexibility like this.

   \itempar{set vector [n] [off]}{cmd!set vector}
      Disables vector control for channel \textsl{n}.

   \itempar{set volume [n]}{cmd!set volume}
      Set the master volume.

   \itempar{reset}{cmd!reset}
      Return to the start-up conditions, if 'y' selected.

   \itempar{stop}{cmd!stop}
      Cease all sound immediately!

   \itempar{mode [s]}{cmd!mode}
      Change to different menus: addsynth, subsynth, or padsynth.

   \itempar{? or help}{cmd!help}
      List commands for current mode.

   \itempar{exit}{cmd!exit}
         Tidy up and close Yoshimi down.

%-------------------------------------------------------------------------------
% vim: ts=3 sw=3 et ft=tex
%-------------------------------------------------------------------------------
