%-------------------------------------------------------------------------------
% yoshimi-user-manual
%-------------------------------------------------------------------------------
%
% \file        yoshimi-user-manual.tex
% \library     Documents
% \author      Chris Ahlstrom
% \date        2015-04-20
% \update      2016-02-25
% \version     $Revision$
% \license     $XPC_GPL_LICENSE$
%
%     This document provides LaTeX documentation for yoshimi.
%
%-------------------------------------------------------------------------------

\documentclass[
 11pt,
 twoside,
 a4paper,
 headinclude,
 footinclude,
 final                                 % versus draft
]{article}

\input{yoshimi-docs-structure}         % specifies document structure and layout

\makeindex

\begin{document}

\title{A Yoshimi 1.3.9 User Manual}
\author{Chris Ahlstrom \texttt{ahlstromcj@gmail.com} with Will J. Godfrey}
\date{\today}
\maketitle
\tableofcontents
\listoffigures                         % print the list of figures
\listoftables                          % print the list of tables

% Change the paragraph style to remove indenting and put a line between each
% paragraph.  This could be moved up into the preamble, but then would
% affect the spacing of the TOC and LOF, LOT noted above.

\setlength{\parindent}{0pt}
\setlength{\parskip}{1ex plus 0.5ex minus 0.2ex}

\section{Introduction}
\label{sec:introduction}

   Still working on catching up to all the new features in 1.3.8.
   There are a \textbf{lot} of them.

   This document was inspired by finding a fairly thorough wiki version of a
   \textsl{ZynAddSubFX} manual (see reference \cite{zynwiki}).  That wiki,
   and the Open Document Format version of it, provided a lot of screen
   shots and a detailed survey of the settings and parameters of
   \textsl{ZynAddSubFX}.  It inspired me to be even more thorough in
   describing \textsl{Yoshimi}.

\subsection{Yoshimi Versus ZynAddSubFX}
\label{subsec:introduction_yoshimi_vs_zyn}

   This document describes how to use \textsl{Yoshimi} \cite{yoshimi},
   the software synthesizer derived from the great
   \textsl{ZynAddSubFx} \cite{zynaddsubfx} software
   synthesizer.  Because of their common origin, much of this document also
   applies to \textsl{ZynAddSubFx} and depends upon some \textsl{ZynAddSubFX}
   documentation and diagrams.

   \textsl{Yoshimi} is an algorithmic MIDI software synthesizer for Linux.
   It synthesizes in real time, can run polyphonic or monophonic, with multiple
   simultaneous patches in one or more MIDI channels, has broad microtonal
   capability, and much more. It includes extensive addititive, subtractive,
   and pad synth capabilities which can be run simultaneously within the
   same patch.  It also has eight audio effects modules.

   Originally based on the 2.4.0 version of \textsl{ZynAddSubFX} (Copyright
   2002-2009 Nasca Octavian Paul), development of \textsl{Yoshimi} has
   continued for quite a while now in its own directions. These include
   major optimizations for audio and MIDI performance, and more recently
   progressive development of user-level access to all controls. At the same
   time refinement continues, both visually and within the code.

   What are the advantages of
   \textsl{Yoshimi} versus \textsl{ZynAddSubFX}?
   At one time \textsl{Yoshimi} had better JACK support
   than \textsl{ZynAddSubFX}, but that is no longer true.
   Both projects are now in active development, and both are
   progressing along their respective roadmaps.

   \textsl{Yoshimi} currently has a cleaner graphical user interface, while
   \textsl{ZynAddSubFX} has a major user-interface upgrade planned.
   On the other hand, \textsl{ZynAddSubFX} has a few features that
   \textsl{Yoshimi} does not, such as being able to easily record
   the output waveforms.  There may be internal differences of importance to
   a developer.  So, really, it is not clear that there is really a big
   advantage to one over the other... use them both and make your own
   decision!

\subsection{New Features}
\label{subsec:introduction_new_features}

   Yoshimi can now run as an LV2 plugin.  Supported features:

   \begin{enumber}
      \item Sample-accurate midi timing.
      \item State save/restore support via LV2\_State\_Interface.
      \item Working UI support via LV2\_External\_UI\_Widget.
      \item Programs interface support via LV2\_Programs\_Interface.
      \item Multi channel audio output.
         'outl' and 'outr' have lv2 index 2 and 3.
         All individual ports numbers start at 4.
   \end{enumber}

   Planned feature:
   Controls automation support.
   This will be a part of a common controls interface.

   Sensitivity to MIDI volume change (CC7) is now variable in 'Controllers' in
   the same way as pan width, etc. The Numeric range is 64 to 127, the default
   at 96 gives the same sensitivity as before at -12dB relative to the GUI
   controls.  127 gives 0dB and 64 gives -26dB.

   \textsl{Yoshimi} now stamps instrument and patch set XML files with its own
   major and minor version numbers so it is possible to tell which version
   created the files, or whether they were created by \textsl{ZynAddSubFX}.

   It is now possible to direct messages to either stderr or the report window
   on the fly. If one chooses 'stderr', the \textbf{Reports} button is greyed
   out.

   Some NRPNs are now supported.
   NRPNs have been extended so that via MIDI one can read most of the dynamic
   system settings (to the Log file). These can now also be set.
   See the new NRPN sections, and, in the source-code bundle:
   Using\_NRPNs.txt; Direct\_Part\_Control.txt; Vector\_Control.txt; and
   Yoshi\_Zyn\_NRPNs.txt

   One can now use the mouse scroll wheel to adjust rotary controls. Holding
   down 'ctrl' gives to finer adjustment.  Also, horizontal as well as vertical
   mouse movement will adjust the knob.

   Part-editing windows carry the part number and voice name in the title bar.
   For the AddSynth oscillator window this also includes the voice number.

   Yoshimi now has up to 64 parts in blocks of 16. One can now decide how many
   one wants to have available using the spinbox alongside the channel number.
   One can have 16, 32 or 64.
   By default, all the upper parts are mapped to the same MIDI channel numbers
   as the lowest ones but have independent voice and patch set values. They can
   not normally receive independent note or control messages. However, vector
   control will intelligently work with however many are set, as will all
   the NRPN direct part controls.

   When opening an instrument bank one can now tell exactly which synth engines
   are used by each instrument. This is represented by three pale background
   colours: Red -> AddSynth; Blue -> SubSynth; and Green -> PadSynth.

   If the instruments are kits they scanned to find out if any member of the
   kit contains each engine.
   This feature is duplicated in the current part, the mixer panel for the
   currently loaded instruments, and in the Instrument Edit window the same
   colours highlight the engine names when they are enabled with the check
   boxes. 

   Bank root directories are better identified, with IDs that can be changed by
   the user in the GUI. This is also made available for selecting over MIDI.

   MIDI only sees banks in the \textsl{current}
   \textbf{root} directory, but all banks are accessible to the GUI.
   More details are provided in \texttt{Banks.txt}.

   It is now possible to set up a new bank root path when starting from the
   command line. This takes the form:

   \begin{verbatim}
      $ yoshimi -D /home/(username)/(directory)/(subdirectory)/bank
   \end{verbatim}

   \textsl{Yoshimi} will then immediately scan this path for new banks, but
   won't make the root (or any of its banks) current. The final directory
   doesn't in fact have to be 'banks' but traditionally we have always done
   this.

   Also, when running from the command line there is now access to many of the
   system and Root, Bank etc. settings.

   \textsl{Yoshimi} now remembers where major windows were last placed (per
   instance), and if any were left open at shutdown, they will be reopened at
   the same location on the next run.

   We have an implimentation of CC2 - breath control. This combines volume with
   filter cutoff.

   To help when things don't seem to go right, one can now show 'raw' incoming
   CCs. This is enabled from the 'MIDI' tab in 'Settings'. These are the values
   before \textsl{Yoshimi} does any processing.

   The earlier experimantal per part random detune features has now been
   formalised with a slider covering the range from 0 to +/- 50 cents, which is
   half-way between adjacent notes on the even tempered scale. This setting is
   now saved in patch sets so will be restored when one reloads the same set.

   Thanks to the Zyn developers, we now have pink as well as white noise
   available on Addsynth voices. Pink noise sounds 'softer'.

   The preferred JACK/ALSA MIDI and audio connections are no longer fixed at
   compile time. There are now checkboxes on 'Settings' to change them.

   With the latest 'depop' port from Zyn, we are now fully compatibly with all
   instrument files.

   \textsl{Yoshimi} will now always start even if the audio/MIDI backend called
   for doesn't exist. In this situation it will try all combinations in the
   order JACK, ALSA, and null. This enables one to then change the settings and
   try again.

   One can also set 'preferred' startup ALSA/JACK/MIDI and audio devices.
   These selections will be remembered on the next run.

   And there's MORE!!!  Yoshimi 1.3.8 highlights.

   MIDI program changes have always been pretty clean from the time Cal first
   introduced them, but now GUI changes are just as clean. While it is
   generally best to change a program when the part is silent, even if a part
   is sounding there is usually barely a click. There is no interference at all
   with any other sounding parts.

   Sometimes MIDI CCs don't seem to give the results you expect. Well, there is
   now a setting that will report all incoming CCs so you can discover what
   Yoshimi actually sees (which may not be what you were expecting).

   At the request of one of our users, we have now implemented CC2, Breath
   Control.

   The 'Humanise' feature has had more interest so it's been upgraded. It's now
   a slider and it's setting can be saved in patch sets. It provides a tiny
   per-note random detune to an *entire* part (all engines in all kits), but
   only to that part.

   Audio and MIDI preferences have been improved. If one sets (say) ALSA MIDI and
   JACK audio, either from the GUI or the command line, the setting can be
   saved and will be reinstated on the next run. These settings are
   per-instance so if you have multiple sound cards you can make full use of
   them.

   Barring major system failures, there are now no circumstances where
   Yoshimi
   will fail to start.

   There is greater control of your working environment. You can have just the
   GUI, just a CLI or both, and these settings can be saved. If you try to
   disable both you will get a polite warning and will be left with just the
   CLI.

   The CLI can now access almost all top level controls as well as the 'main
   page' part ones and can select any effect and effect preset, but can't yet
   deal with the individual effects controls. It can be used to set up Vector
   Control much more quickly and easily than using NRPNs.

   It is also context sensitive, which along with careful choice of command
   names and abreviations allows very fast access with minimal typing.

   Yoshimi's parser is case insensitive to commands (but not filenames etc.)
   and accepts the shortest unambiguous abbreviation. However it is quite
   pedantic, and expects spelling to be correct regardless of length. Apart
   from the 'back' commands, it is word-based so spaces are significant.

   Some examples:

   \begin{verbatim}
   \end{verbatim}
   s p 4 pr 6 (set part 4 program 6)

   This sets part 4 to the instrument with ID 6 from the current bank. It also
   then leaves you at part context level and pointed to part 4. Additionally,
   it will activate that part if it was off (and the config setting is
   checked). In most cases the words 'program' and 'instrument' are
   interchangable.

   \begin{verbatim}
      s ef 1 ty rev
   \end{verbatim}

   This moves you up to part effects context level and sets that part's effect
   number 1 to effect type 'reverb'.

   \begin{verbatim}
      s pre 2
   \end{verbatim}

   Sets preset number 2 (we use numbers there as most preset names repeat the
   effect type).

   \begin{verbatim}
      ..s 6 v 80
   \end{verbatim}

   Drops you back to part level, switches you to part 6 and sets its volume to
   80 (but doesn't actually enable it).

   \begin{verbatim}
      /s ve cc 93
   \end{verbatim}

   Goes back to the top level and sets vector control for channel 0, X axis to
   respond to CC 93 leaving you in the vector context.

   Whenever intermediate values are omitted default or last used will be
   assumed, and all counting starts from zero.
   The CLI prompt always shows what level you are on, and the help lists are
   also partly context sensitive so you don't get a lot of irrelevent clutter.
   There is more, and a lot more to come!
   While doing all this work, we've alse ensured that Yoshimi instrument
   patches are still fully compatible with Zyn ones, and have now ported across
   the new refinements with thanks.

\subsection{Document Structure}
\label{subsec:introduction_document_structure}

   The structure of this document is a struggle.  No matter which route is
   taken, there's no way to avoid jumping all over this document to
   adequately cover a topic.  Therefore, the sections are basically provided
   in the order their contents appear in the user interface of
   \textsl{Yoshimi}.  To help the reader jump around this document, multiple
   links and references are supplied.

   \index{tips!in document}
   Usage tips
   for each of the functions provided in
   \textsl{Yoshimi} are sprinkled throughout this document.
   Each tip occurs in a section beginning with "Tip:".
   Each tip is provided with an entry in the Index, under the
   main topic "tips".

   \index{bugs!in document}
   Bug notes
   for some of the oddities found in \textsl{Yoshimi} are
   sprinkled throughout this document.
   Each bug occurs in a sentence beginning with "Bug:".
   Each bug is provided with an entry in the Index, under the
   main topic "bugs".

   \index{new!in document}
   New features
   since the last version are flagged with "New:"

   \index{todo!in document}
   TODO items
   are also present, in the same vein.
   This document currently has a lot of them!

\subsection{Yoshimi Mailing List}
\label{subsec:introduction_mailing_list}

   The \textsl{Yoshimi} project used to have an email listserv at
   SourceForge, but the unreliability of the site has prompted a move to a
   new mailing list.  See reference \cite{yoshiminews}.  The team have
   managed to port across all the old yoshimi-user archives to this new
   site.  See reference \cite{yoshiminewsarchive}.

   Subscribe to the \textsl{Yoshimi} mailing list with an e-mail to:
   \url{yoshimi-request@freelists.org} or by visiting 
   \url{http://www.freelists.org/list/yoshimi}.

   To post to the list, send an email to: \url{yoshimi@freelists.org}.
   The news archive is at: \url{https://www.freelists.org/archive/yoshimi}.

\subsection{Yoshimi Licensing}
\label{subsec:introduction_yoshimi_licensing}

   Before we get started, one more thing.

   \begin{quotation}
      Software licenses are are something I \textsl{really}
      don't want to get involved in - I have much better things to do with my
      time - but I found I was obliged to do so.

      It is possible I'm the only person who knows all the following events, as
      I was the one that instigated them!

      The first time I saw ZynAddSubFX source files they were licensed as GPL
      V2. At that time Zyn had a number of very serious problems, and not much
      was being done about them. Somewhat naively I asked Lars Luthman if he
      would help, as he had offered a couple of small patches previously. His
      response was that he would not do any significant work, as he did not
      agree with the GPL V2 only license.

      I then contacted Paul, explaining the situation and asking if he would
      consider a change in the license to V2 or later. I was actually a bit
      surprised that he immediately agreed. When I next looked at the sources,
      the licenses on the files had indeed been updated, so I passed this
      information on.

      Unfortunately Paul forgot to update the website, but I wasn't especially
      concerned as it was only the files themselves that really mattered.

      While developing Yoshimi after the initial fork, Cal queried the license
      situation. I told him of the conversations I'd had, and passed him a copy
      of the email I'd got from Paul. Later on, Cal - in good faith - wrote new
      sources and placed them under GPL V3. This would be quite compatible with
      V2 or later, but not with V2 strict.

      What I didn't notice until very much later was that Paul had only updated
      half of the text in the sources, leaving the actual licence in an
      ambiguous state.

      To the best of my knowledge, V3 is not compatible with V2 strict, but V2
      or later is. However the \textsl{complete}
      project then becomes downgraded to V2
      strict - although the V2 or later sources (such as all the new root/bank
      code) can independently be freely merged into V3 code.

      I doubt anyone would actually make an issue of this. However, to safeguard
      Yoshimi as a whole, I took it upon myself to change Cal's code to V2 or
      later. I believe it retains the spirit of his wishes, and the only person
      with standing to object -- his daughter - has been totally supportive of
      the work currently being done on Yoshimi.

      Any source code I add will be GPL V2 or later.

      Update.

      The original change discussion has now been located and the license for
      both Zyn and Yoshi is confirmed as GPL V2 or later.

      Anyone wanting to confirm this should look at the Zyn user list archives
      August 2007 and September 2007.
   \end{quotation}

\subsection{Let's Get Started with Yoshimi!}
\label{subsec:introduction_lets_get_started}

   Let us run \textsl{Yoshimi}, but run it without using \textsl{JACK}, which
   complicates the discussion of \textsl{Yoshimi}.  The first
   thing to do is make sure one has no other sound application running
   (unless one wants to risk blocking \textsl{Yoshimi} or hearing two sounds
   simultaneously, depending on one's sound card and ALSA setup).
   Then start \textsl{Yoshimi} so that it uses ALSA for audio and ALSA for
   MIDI.  Also use the "\&" character so that we get back to the
   command-line prompt.
   See \sectionref{sec:yoshimi_man_page}.

\begin{verbatim}
   $ yoshimi -a -A &
\end{verbatim}

\begin{figure}[H]
   \centering 
   \includegraphics[scale=0.75]{Yosh-splash-OTW-1.png}
   \caption{Yoshimi Splash Screen!}
   \label{fig:yoshimi_splash_screen}
\end{figure}

   One sees a brief message, and then the splash screen.
   We show the splash screen, figure~\ref{fig:yoshimi_splash_screen},
   here because it goes away too
   fast when one runs \textsl{Yoshimi}!
   What fun is that?

\begin{figure}[H]
   \centering 
   \includegraphics[scale=1.0]{1.3.8/yoshimi-first-screen.jpg}
   \caption{Yoshimi Main Screen, 1.3.8}
   \label{fig:yoshimi_main_screen}
\end{figure}

%  \includegraphics[scale=1.0]{yoshimi-first-screen.jpg}
%  \includegraphics[scale=1.0]{1.3.5/yoshimi-first-screen.png}
%  That figure a bit out-of-date (it does not show the new "Part of"
%  feature), so we've replaced it with a new screen capture.
   
   Then the \textsl{Yoshimi} main window appears, as shown in
   \figureref{fig:yoshimi_main_screen}.

   TODO:  Discuss the new UI elements.

   For this manual, we describe the main window as being composed of
   the following sections:

\begin{enumber}
   \item \textbf{Menu}.
   \item \textbf{Top Panel}.
   \item \textbf{Effects Panel}.
   \item \textbf{Bottom Panel}.  Includes the VU-meter at the bottom.
\end{enumber}

   There's a lot going on with \textsl{Yoshimi}, and there's no way to describe
   it in linear order.  This manual will describe how to do useful things in
   each of the sections noted above, while leaving some of the details to be
   described in later sections, to which reference can be made for the details.
   This document depends heavily on index entries and references.

   Finally, if one grabs the latest source code for \textsl{Yoshimi}, in the
   'examples' directory there is a complete song set, 'OutThere.mid' and
   'OutThere.xmz'. Together these produce a fairly complex 12 part tune that
   makes \textsl{Yoshimi} work quite hard.

% Important Concepts

\input{yum_concepts}

% Banks and Roots

\input{yum_banks_and_roots}

% Menu

\input{yum_menu}

% Settings Index and Descriptions

\input{yum_settings}

% Top Panel User-Interface items

\input{yum_top_panel}

% Middle Panel Effects User-Interface items

\input{yum_effects}

% Bottom Panel User-Interface items

\input{yum_bottom_panel}

% ADDsynth User-Interface items

\input{yum_addsynth}

% PADsynth User-Interface items

\input{yum_padsynth}

% SUBsynth User-Interface items

\input{yum_subsynth}

% Kit Edit User-Interface items

\input{yum_kitedit}

% Banks

\input{yum_bank_collection}

% NRPNS and effects in more detail

\input{yum_nrpns}

% "Vector" control

\input{yum_vector_control}

% Command-line mode

\input{yum_command_line}

% Yoshimi as an LV2 plugin

\input{yum_LV2}

% Man page

\input{yum_manpage}

% Building and debugging Yoshimi

\input{yum_build}

\section{Summary}
\label{sec:summary}

   In summary, we can say that you will absolutely love \textsl{Yoshimi}.

   There are some topics that this document does not yet treat:

      \begin{itemize}
         \item Changing the colors and style of the GUI, as seen in some
            versions of \textsl{ZynAddSubFX}.  This does not yet seem possible,
            because the synth part is not truly separate from the GUI, and the
            \textsl{Yoshimi} developers have not found it easy to recode the
            FLTK GUI.
      \end{itemize}

   \begin{quotation}
      A car analogy.

      A sample player is a drive along a straight, wide, almost new highway
      with only 2 other cars in sight, on a lightly overcast summer's day in a
      Ford Fiesta at around 40 MPH.

      Yoshimi is a white-knuckle trip over a Swiss mountain pass in a blizzard,
      at night, facing donkeys, trucks and bandits, while driving an open-frame
      kit car doing 90 +

      In recent times we've been able to dispose of the donkeys, and the
      bandits are on the run :)
   \end{quotation}

% References

\input{yum_references}

\printindex

\end{document}

%-------------------------------------------------------------------------------
% vim: ts=3 sw=3 et ft=tex
%-------------------------------------------------------------------------------
